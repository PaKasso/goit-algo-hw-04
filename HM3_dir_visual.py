import os
import sys
from colorama import Fore, Style

# os використовується для роботи з операційною системою (отримання списку файлів і каталогів).
# sys потрібен для отримання аргументів командного рядка.
# colorama імпортує Fore для кольорів тексту і Style для стилів тексту (наприклад, яскравість).

def list_files_and_dirs(directory):
    """
    Функція для виведення структури файлів та піддиректорій у заданому каталозі.

    Параметри:
    - directory (str): Шлях до каталогу, для якого потрібно вивести структуру.
    """
    try:
        # Основний цикл для обходу директорій і файлів у вказаному каталозі та його підкаталогах
        for root, dirs, files in os.walk(directory):
            # Визначаємо рівень вкладеності поточної директорії відносно початкової директорії
            level = root.replace(directory, '').count(os.sep)
            indent = ' ' * 4 * (level)  # Відступ для кожного рівня вкладеності
            
            # Виводимо назву поточної директорії з кольором за допомогою colorama
            print(f'{Style.BRIGHT}{Fore.BLUE}{indent}[{os.path.basename(root)}]{Style.RESET_ALL}')
            
            # Відступ для файлів та підкаталогів у поточній директорії
            sub_indent = ' ' * 4 * (level + 1)
            
            # Виводимо всі файли у поточній директорії зеленим кольором
            for file in files:
                print(f'{sub_indent}{Fore.GREEN}{file}')
            
            # Виводимо всі підкаталоги у поточній директорії жовтим кольором
            for dir in dirs:
                print(f'{sub_indent}{Fore.YELLOW}{dir}')
    
    except FileNotFoundError:
        print(f"Каталог '{directory}' не знайдено.")
    
    except PermissionError:
        print(f"Немає доступу до каталогу '{directory}'.")
# os.walk(directory) дозволяє рекурсивно обходити всі підкаталоги та файли у вказаному каталозі.
# os.sep використовується для отримання символу роздільника шляхів відповідно до операційної системи.
# Кольорове виведення використовує colorama для надання різних кольорів піддиректоріям (жовтий) і файлам (зелений).




def main():
    """
    Основна функція програми, що обробляє командний рядок та викликає функцію для виведення структури каталогів.
    """
    # Перевірка коректності введення командного рядка
    if len(sys.argv) != 2:
        print("Використання: python script.py <шлях_до_каталогу>")
        return
    
    # Отримання шляху до директорії з аргументу командного рядка
    directory_path = sys.argv[1]
    
    # Перевірка, чи введений шлях є дійсним каталогом
    if not os.path.isdir(directory_path):
        print(f"Помилка: '{directory_path}' не є дійсним каталогом.")
        return

    # Виклик функції для виведення структури каталогу
    list_files_and_dirs(directory_path)

# Перевірка на наявність правильного кількості аргументів командного рядка.
# sys.argv[1] містить шлях до директорії, отриманий з командного рядка.
# Перевірка, чи введений шлях існує та є дійсним каталогом перед передачею його до функції list_files_and_dirs.

if __name__ == "__main__":
    main()